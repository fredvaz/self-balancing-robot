clear all
close all
clc

format short 

%--------------------------------------------------------------------------
%
%                            Self-Balancing Robot
%
%--------------------------------------------------------------------------
% Authors: Frederico Vaz
%          Pedro Eug√©nio
%
% email: fredvaz8@gmail.com
%        pedroeugenio@gmail.com
%
% November 2018; Last revision: December-2018
%--------------------------------------------------------------------------
%
% Description:
%
%--------------------------------------------------------------------------
%
% References:
%
%--------------------------------------------------------------------------

%%                       System Plant Parameters 

l = 0.2;          % distance between robot torso's gravity center and axle;
m = 0.05;         % wheel's mass;
mp = 0.5;         % robot torso's mass;
I = 1;            % robot torso's rotational inertia;
g = 9.8;          % gravitational force;

% Compute Transfer Function on continuous time based on the Dynamics System
[ Hs, zeros, poles, k ] = dynamic_system(l, m, mp, I, g);

p1 = poles(1); p2 = poles(2);


%%                             Root Locus 



%%                       Controller Parameters 

h = 5e-3;

Pertub = 1;
k_pertub = 1;
t_pertub = 5;

k_noise = 1;

kp = 497;
ki = 180;
kd = 40;


%% TESTES

plot(alfa);
grid on

%%
%out = [ -0.94,-0.94,-0.94,-0.94,-0.94,-0.95,-0.95,-0.95,-0.95,-0.95,-0.95,-0.95,-0.95,-0.95,-0.95,-0.95,-0.95,-0.95,-0.95,-0.95,-0.95,-0.95,-0.95,-0.95,-0.96,-0.96,-0.96,-0.96,-0.96,-0.96,-0.96,-0.96,-0.96,-0.96,-0.97,-0.97,-0.97,-0.97,-0.97,-0.96,-0.96,-0.96,-0.96,-0.96,-0.96,-0.97,-0.97,-0.97,-0.97,-0.97,-0.97,-0.97,-0.97,-0.97,-0.98,-0.98,-0.98,-0.98,-0.98,-0.98,-0.98,-0.98,-0.98,-0.98,-0.98,-0.98,-0.98,-0.98,-0.98,-0.98,-0.98,-0.98,-0.98,-0.98,-0.98,-0.98,-0.98,-0.98,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-0.99,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.00,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.00,-1.00,-1.00,-1.00,-1.01,-1.01,-1.01,-1.01,-1.01,-1.01,-1.02,-1.02,-1.02,-1.03,-1.03,-1.03,-1.02,-1.02,-1.02,-3.08,-3.06,-3.04,-3.02,-3.00,-2.98,-2.96,-2.94,-2.92,-2.91,-2.89,-2.87,-2.86,-2.84,-2.83,-2.81,-2.79,-2.77,-2.75,-2.73,-2.71,-2.69,-2.67,-2.66,-2.64,-2.63,-2.61,-2.60,-2.58,-2.57,-2.56,-2.54,-2.53,-2.51,-2.50,-2.48,-2.46,-2.45,-2.43,-2.41,-2.40,-2.38,-2.37,-2.36,-2.35,-2.34,-2.33,-2.31,-2.30,-2.29,-2.28,-2.27,-2.25,-2.24,-2.23,-2.21,-2.20,-2.19,-2.17,-2.16,-2.15,-2.14,-2.13,-2.12,-2.11,-2.10,-2.09,-2.09,-2.08,-2.07,-2.06,-2.15,-2.21,-2.23,-2.21,-2.18,-2.09,-2.03,-2.01,-2.00,-2.00,-2.00,-1.99,-1.97,-1.95,-1.94,-1.93,-1.92,-1.91,-1.90,-1.89,-1.88,-1.87,-1.86,-1.85,-1.84,-1.84,-1.83,-1.82,-1.81,-1.81,-1.80,-1.79,-1.79,-1.77,-1.74,-1.71,-1.70,-1.69,-1.69,-1.68,-1.68,-1.69,-1.69,-1.69,-1.68,-1.67,-1.66,-1.66,-1.65,-1.64,-1.63,-1.62,-1.61,-1.58,-1.55,-1.52,-1.49,-1.45,-1.41,-1.36,-1.31,-1.24,-1.17,-1.09,-1.00,-0.90,-0.77,-0.60,-0.39,-0.12,0.19,0.55,0.92,1.33,1.78,2.22,2.67,3.12,3.60,4.06,4.52,5.01,5.47,5.91,6.34,6.74,7.12,7.50,7.88,8.24,8.61,8.97,9.36,9.72,10.06,10.39,10.73,11.06,11.38,11.68,11.99,12.30,12.59,12.88,17.22,17.47,17.70,17.92,18.14,18.35,18.56,18.78,19.01,19.24,19.47,19.72,19.98,20.23,20.48,20.74,20.99,21.23,21.46,21.70,21.92,22.14,22.35,22.56,22.76,22.95,23.12,23.28,23.43,23.57,23.72,23.85,24.00,24.14,24.30,24.45,24.60,24.75,24.89,25.05,25.19,25.35,25.49,25.63,25.76,25.90,26.04,26.18,26.31,26.45,26.59,26.75,26.92,27.10,27.29,27.48,27.67,27.86,28.05,28.24,28.41,28.57,28.72,28.87,28.99,29.11,29.22,29.32,29.42,29.53,29.63,29.73,29.84,29.96,30.08,30.22,30.40,30.60,30.83,31.07,31.34,31.61,31.90,32.18,32.50,32.83,33.13,33.46,33.76,34.06,36.21,36.48,36.73,36.99,37.21,37.42,37.61,37.79,37.96,38.13,38.27,38.37,38.45,38.53,38.61,38.68,38.75,38.81,38.87,38.94,39.02,39.11,39.22,39.32,39.42,39.49,39.56,39.62,39.68,39.73,39.77,39.77,39.71,39.62,39.46,39.24,38.97,38.64,38.26,37.83,37.32,36.77,36.17,35.51,34.77,34.02,33.21,32.32,31.44,30.50,29.58,28.65,27.70,26.69,25.74,24.81,23.88,23.02,22.15,21.26,20.44,19.66,18.90,18.23,17.57,16.97,16.41,15.88,15.36,14.87,14.39,13.91,13.40,12.89,12.37,11.83,11.26,10.63,9.99,9.33,8.64,7.87,7.09,6.24,5.29,4.36,3.41,2.38,1.39,0.39,-0.61,-1.62,-2.56,-3.52,-4.40,-5.26,-6.11,-6.98,-7.80,-8.65,-9.45,-10.24,-11.10,-11.92,-12.75,-13.60,-14.46,-15.33,-16.26,-17.19,-18.13,-19.03,-19.92,-20.72,-21.47,-22.23,-22.91,-23.56,-24.20,-24.80,-25.42,-26.02,-26.60,-27.18,-27.79,-28.37,-28.96,-29.55,-30.16,-30.75,-31.34,-31.93,-32.51,-33.10,-33.63,-34.14,-34.66,-35.14,-35.61,-36.02,-36.38,-36.69,-36.94,-37.12,-37.24,-37.29,-37.28,-37.24,-37.18,-37.11,-37.03,-36.97,-36.91,-36.86,-36.83,-36.82,-36.84,-36.90,-37.00,-37.13,-37.30,-37.49,-37.72,-37.93,-38.14,-38.33,-38.52,-38.70,-38.84,-38.97,-39.05,-39.10,-39.15,-39.19,-39.24,-39.31,-39.39,-39.49,-39.60,-39.72,-39.88,-40.09,-40.32,-40.56,-40.78,-41.01,-41.24,-41.49,-41.77,-42.05,-42.27,-42.46,-42.63,-42.79,-42.91,-43.02,-43.13,-43.25,-43.37,-43.50,-43.62,-43.72,-43.80,-43.89,-43.97,-44.04,-44.09,-44.13,-44.16,-44.19,-44.21,-44.23,-44.23,-44.21,-44.18,-44.16,-44.16,-44.18,-44.22,-44.27,-44.33,-44.40,-44.46,-44.52,-44.58,-44.64,-44.71,-44.77,-44.82,-44.87,-44.92,-44.97,-45.02,-45.06,-45.08,-45.08,-45.07,-45.03,-44.97,-44.90,-44.82,-47.53,-47.40,-47.27,-47.13,-46.97,-46.80,-46.62,-46.42,-46.20,-45.98,-45.74,-45.49,-45.24,-45.00,-44.76,-44.55,-44.35,-44.15,-43.94,-43.71,-43.48,-43.24,-42.99,-42.72,-42.48,-42.24,-42.01,-41.74,-41.44,-41.10,-40.72,-40.33,-39.89,-39.43,-38.95,-38.43,-37.89,-37.29,-34.87,-34.26,-33.63,-32.98,-32.26,-31.54,-30.78,-29.93,-29.07,-28.19,-27.28,-26.33,-25.40,-24.44,-23.47,-22.48,-21.46,-20.50,-19.57,-18.63,-17.66,-16.77,-15.95,-15.21,-14.54,-13.90,-13.25,-12.65,-12.17,-11.73,-11.36,-11.01,-10.62,-10.24,-9.85,-9.45,-9.01,-8.53,-8.00,-7.41,-6.71,-6.02,-5.30,-4.57,-3.76,-2.95,-2.08,-1.14,-0.22,0.71,1.70,2.66,3.66,4.60,5.48,6.37,7.15,7.89,8.62,9.29,9.96,10.57,11.15,11.62,12.04,12.42,12.78,13.10,13.38,13.63,13.89,14.13,14.38,14.63,14.91,15.21,15.52,15.87,16.27,16.69,17.20,17.73,18.33,18.97,19.67,20.35,21.02,21.68,22.38,23.03,23.71,24.36,25.03,25.65,26.24,26.77,27.27,27.71,28.13,28.55,28.95,29.34,29.76,30.17,30.60,31.00,31.38,31.77,32.14,32.53,32.89,33.26,33.64,33.97,35.01,35.34,35.59,35.79,35.92,35.99,36.00,35.96,35.85,35.65,35.36,34.97,34.45,33.85,33.17,32.39,31.57,30.67,29.61,28.47,27.22,25.87,24.55,23.23,21.84,20.51,19.19,17.89,16.56,15.33,14.15,12.99,11.83,10.78,9.75,8.74,7.86,7.04,6.28,5.53,4.87,4.25,3.64,3.09,2.58,2.08,1.62,1.18,0.75,0.29,-0.14,-0.56,-0.93,-1.22,-1.46,-1.59,-1.65,-1.68,-1.69,-1.69,-1.68,-1.68,-1.67,-1.66,-1.65,-1.63,-1.60,-1.58,-1.56,-1.54,-1.52,-1.51,-1.49,-1.46,-1.45,-1.43,-1.42,-1.41,-1.41,-1.40,-1.40,-1.40,-1.39,-1.39,-1.39,-1.38,-1.38,-1.37,-1.37,-1.36,-1.35,-1.35,-1.34,-1.34,-1.33,-1.33,-1.33,-1.33,-1.32,-1.32,-1.32,-1.32,-1.32,-1.32,-1.32,-1.32,-1.32,-1.32,-1.31,-1.31,-1.31,-1.30,-1.30,-1.30,-1.29,-1.29,-1.29,-1.29,-1.28,-1.28,-1.28,-1.27,-4.02,-3.99,-3.96,-3.93,-3.90,-3.87,-3.84,-3.81,-3.78,-3.76,-3.73,-3.70,-3.67,-3.65,-3.62,-3.60,-3.57,-3.55,-3.52,-3.50,-3.47,-3.44,-6.12,-6.06,-6.01,-5.96,-5.91,-5.86,-5.82,-5.77,-5.72,-5.68,-5.63,-5.58,-5.54,-5.49,-5.45,-5.41,-5.36,-5.32,-5.28,-5.24,-5.19,-5.15,-5.11,-5.07,-5.02,-4.98,-4.93,-4.89,-4.86,-4.82,-4.78,-4.74,-4.71,-4.67,-4.63,-4.60,-4.56,-4.53,-4.49,-4.45,-4.42,-4.38,-4.35,-4.32,-4.28,-4.25,-4.22,-4.19,-4.16,-4.13,-4.09,-4.06,-4.03,-4.00,-3.96,-3.93,-3.90,-3.87,-3.84,-3.81,-3.78,-3.76,-3.73,-3.71,-3.68,-3.65,-3.62,-3.60,-3.57,-3.55,-3.52,-3.49,-3.46,-3.44,-3.41,-3.38,-3.35,-3.33,-3.32,-3.32,-3.30,-3.29,-3.28,-3.28,-3.27,-3.25,-3.21,-3.17,-3.12,-3.06,-3.02,-2.98,-2.96,-2.93,-2.91,-2.89,-2.90,-2.92,-2.91,-2.89,-2.86,-2.84,-2.83,-2.80,-2.79,-2.77,-2.76,-2.75,-2.75,-2.76,-2.77,-2.77,-2.76,-6.77,-6.71,-6.64,-6.58,-6.51,-6.46,-6.41,-6.37,-6.32,-6.26,-6.20,-6.13,-6.07,-6.02,-5.97,-5.92,-5.87,-5.82,-5.77,-5.73,-5.68,-5.63,-5.59,-5.55,-5.50 ];
%out = [ -1.16,-1.16,-1.16,-1.16,-1.16,-1.15,-1.15,-1.15,-1.15,-1.15,-1.15,-1.15,-1.15,-1.15,-1.14,-1.14,-1.14,-1.14,-1.14,-1.13,-1.13,-1.13,-1.13,-1.13,-1.13,-1.13,-1.13,-1.13,-1.13,-1.13,-1.12,-1.12,-1.12,-1.12,-1.12,-1.12,-1.12,-1.12,-1.12,-1.11,-1.11,-1.11,-1.11,-1.11,-1.11,-1.11,-1.11,-1.11,-1.11,-1.11,-1.11,-1.11,-1.11,-1.11,-1.10,-1.10,-1.10,-1.10,-1.10,-1.10,-1.10,-1.10,-1.10,-1.10,-1.10,-1.10,-1.09,-1.09,-1.09,-1.09,-1.08,-1.08,-1.08,-1.08,-1.08,-1.08,-1.08,-1.09,-1.09,-1.09,-1.09,-1.09,-1.09,-1.09,-1.09,-1.09,-1.08,-1.08,-1.08,-1.08,-1.08,-1.08,-1.08,-1.08,-1.08,-1.08,-1.08,-1.08,-1.08,-1.08,-1.08,-1.08,-1.08,-1.08,-1.08,-1.08,-1.07,-1.07,-1.07,-1.07,-1.07,-1.07,-1.07,-1.07,-1.07,-1.07,-1.07,-1.07,-1.07,-1.07,-1.07,-1.07,-1.07,-1.07,-1.07,-1.07,-1.06,-1.06,-1.06,-1.06,-1.06,-1.06,-1.06,-1.06,-1.06,-1.06,-1.06,-1.06,-1.06,-1.06,-1.06,-1.06,-1.06,-1.06,-1.06,-1.06,-1.06,-3.98,-3.95,-3.92,-3.89,-3.86,-3.83,-3.80,-3.77,-3.75,-3.72,-3.69,-3.66,-3.64,-3.61,-3.59,-3.56,-3.54,-3.51,-3.49,-3.46,-3.44,-3.41,-3.39,-3.37,-3.34,-3.32,-3.30,-3.27,-3.25,-3.23,-3.21,-3.19,-3.16,-3.14,-3.12,-3.10,-3.07,-3.05,-3.03,-3.01,-2.99,-2.97,-2.95,-2.93,-2.91,-2.89,-2.87,-2.85,-2.84,-2.82,-2.80,-2.78,-2.76,-2.75,-2.73,-2.71,-2.70,-2.68,-2.66,-2.65,-2.63,-2.61,-2.60,-2.58,-2.57,-2.55,-2.54,-2.52,-2.51,-2.49,-2.48,-2.47,-2.45,-2.44,-2.42,-2.41,-2.40,-2.38,-2.37,-2.36,-2.34,-2.33,-2.32,-2.30,-2.29,-2.28,-2.26,-2.25,-2.24,-2.23,-2.22,-2.20,-2.19,-2.18,-2.17,-2.15,-2.14,-2.13,-2.12,-2.11,-2.10,-2.09,-2.08,-2.07,-2.06,-2.04,-2.03,-2.02,-2.01,-2.00,-1.99,-1.98,-1.97,-1.96,-1.95,-1.94,-1.93,-1.92,-1.91,-1.90,-1.90,-1.89,-1.88,-1.87,-1.86,-1.86,-1.85,-1.84,-1.83,-1.82,-1.82,-1.81,-1.80,-1.80,-1.79,-1.78,-1.77,-1.77,-1.76,-1.76,-1.74,-1.73,-1.72,-1.71,-1.70,-1.70,-1.69,-1.68,-1.68,-1.68,-1.66,-1.65,-1.62,-1.58,-1.55,-1.51,-1.46,-1.40,-1.35,-1.27,-1.10,-0.84,-0.72,-0.69,-0.72,-0.81,-0.92,-1.05,-1.13,-1.16 ];
out = []
plot(out)
grid on


%% BACKUPS 
% "I" is robot torso's rotational inertia;
% "F" is the friction that ground provides with robot's wheels to move;
% "N" is the horizontal direction of interaction force between wheels and robot's torso;
% "P" is the vertical direction of interaction force between wheels and robot's torso;

% F = 1; N = 1; P = 1; 








